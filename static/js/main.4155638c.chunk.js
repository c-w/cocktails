(this.webpackJsonpcocktails=this.webpackJsonpcocktails||[]).push([[0],{192:function(e,t,r){e.exports=r(334)},333:function(e,t,r){},334:function(e,t,r){"use strict";r.r(t);var a=r(0),s=r.n(a),n=r(43),i=r.n(n),o=r(18),c=r(29),l=r(118),p=r(21),h=r(47),m=r(65),d=r(177),u=r(89),g=r(180),E=r(182);class f extends s.a.PureComponent{constructor(e){super(e),this.onPageChange=(e,t)=>{const r=t.activePage;this.setState({activePage:r})},this.state={activePage:1}}render(){const e=this.state.activePage,t=this.props,r=t.items,a=t.itemsPerPage,n=t.className,i=Math.ceil(r.length/a),o=(e-1)*a,c=o+a,l=r.slice(o,c);return s.a.createElement("div",{className:n},s.a.createElement("div",{className:"group"},s.a.createElement(g.a.Group,{items:l})),s.a.createElement("div",{className:"pagination"},s.a.createElement(E.a,{prevItem:null,nextItem:null,firstItem:null,lastItem:null,activePage:e,onPageChange:this.onPageChange,totalPages:i})))}}var w=r(181),S=r(162),b=r.n(S);class v extends s.a.Component{constructor(e){super(e),this.onChange=(e,t)=>{const r=t.value;this.setState({value:r},()=>this._onChange(r))},this.state={value:e.defaultValue},this._onChange=b()(e.onChange,250)}render(){const e=this.props,t=e.placeholder,r=e.className,a=this.state.value;return s.a.createElement("div",{className:r},s.a.createElement(w.a,{icon:"search",value:a,placeholder:t,onChange:this.onChange}))}}class C{constructor(){this._map={}}add(e,t){this._map[e]||(this._map[e]=[]),this._map[e].push(t)}get(e){return this._map[e]||[]}map(e){return Object.entries(this._map).map(e)}}var P={recipesCacheWarning:"Using cached recipes, last updated:",recipesLoadError:"Something went wrong while loading the recipes",recipesSearchPlaceholder:"Search for recipes...",recipesSortByDate:"Sort by date",recipesSortByRating:"Sort by rating",meanRatingSupport:"Cocktails",meanRatingValue:"Avg Rating",brandsSearchPlaceholder:"Search for brands...",spiritsSearchPlaceholder:"Search for spirits...",bottlesSpiritSelectPlaceholder:"Select spirit...",bottlesSpiritAllEntries:"(All)",menuEntryRecipes:"Recipes",menuEntrySpirits:"Top Spirits",menuEntryBrands:"Top brands",menuEntryBottles:"Top bottles",menuEntryAI:"AI"};const y=["orange","yellow","olive","green","teal","blue","violet","purple","pink","brown"],x=({name:e,mean:t,support:r})=>{const a=(e=>y[Math.abs(function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t|=0}return t}(e))%y.length])(e);return{key:e,header:e,color:a,description:s.a.createElement(c.b,{to:"/recipes/".concat(e)},s.a.createElement(u.a.Group,null,s.a.createElement(u.a,{label:P.meanRatingSupport,value:r,color:a}),s.a.createElement(u.a,{label:P.meanRatingValue,value:t.toFixed(2),color:a})))}};class R extends s.a.PureComponent{constructor(e){super(e),this.onSearchTextChange=e=>{this.setState({filterText:e})},this.state={filterText:e.query||""}}render(){const e=this.props,t=e.aggregations,r=e.recipes,a=e.ratingsPerPage,n=e.searchPlaceholder,i=this.state.filterText,o=(e=>{if(e.startsWith("#<")){const t=parseInt(e.substr(2),10);return({support:e})=>e<t}if(e.startsWith("#>")){const t=parseInt(e.substr(2),10);return({support:e})=>e>t}if(e.length>0){const t=e.toLowerCase().split("||").map(e=>e.trim());return({name:e})=>t.some(t=>-1!==e.toLowerCase().indexOf(t))}return()=>!0})(i),c=((e,t)=>{const r=new C;return t.forEach(t=>e.filter(e=>-1!==e.Ingredients.toLowerCase().indexOf(t.toLowerCase())).forEach(e=>r.add(t,e.Rating))),r.map(([e,t])=>{return{name:e,mean:(r=t,function(e){return e.reduce((e,t)=>e+t,0)}(r)/r.length),support:t.length};var r}).sort((e,t)=>Math.sign(t.mean-e.mean))})(r,t).filter(o);return s.a.createElement("div",null,s.a.createElement("div",{className:"brandControls"},n&&s.a.createElement(v,{className:"searchBar",defaultValue:i,placeholder:n,onChange:this.onSearchTextChange})),s.a.createElement(f,{className:"paginatedCardGroup",itemsPerPage:a,items:c.map(x),key:c}))}}function k(e){return new RegExp("\\s(".concat(Array.from(e).join("|"),")(\\s|$)"),"i")}function T(e,t,r){const a=k(e?[e]:t),s=new Set;return r.forEach(e=>e.Ingredients.split("\n").filter(e=>null!=e.match(a)).map(e=>e.replace(/\([^)]*\)/g,"")).map(e=>e.replace(/^[^ ]*/,"")).map(e=>e.trim()).forEach(e=>s.add(e))),Array.from(s).sort()}class I extends s.a.PureComponent{constructor(e){super(e),this.onSpiritChange=e=>this.setState({selectedSpirit:e}),this.state={selectedSpirit:e.query}}render(){const e=this.props,t=e.words,r=e.recipes,a=e.ratingsPerPage,n=this.state.selectedSpirit;return s.a.createElement("div",null,s.a.createElement("div",{className:"bottleControls"},s.a.createElement(N,{selectedSpirit:n,spirits:t.spirits,onChange:this.onSpiritChange})),s.a.createElement(q,{spirit:n,spirits:t.spirits,recipes:r,ratingsPerPage:a}))}}class N extends s.a.PureComponent{constructor(...e){super(...e),this.onChange=(e,{value:t})=>this.props.onChange(t)}render(){const e=this.props,t=e.spirits,r=e.selectedSpirit,a={text:P.bottlesSpiritAllEntries,value:""},n=Array.from(t).sort().map(e=>({text:e,value:e})),i=[a].concat(n);return s.a.createElement(d.a,{search:!0,selection:!0,placeholder:P.bottlesSpiritSelectPlaceholder,options:i,onChange:this.onChange,defaultValue:r})}}class q extends s.a.PureComponent{render(){const e=this.props,t=e.spirit,r=e.spirits,a=e.recipes,n=e.ratingsPerPage;return s.a.createElement(R,{aggregations:T(t,r,a),recipes:a,ratingsPerPage:n})}}class O extends s.a.PureComponent{render(){const e=this.props,t=e.words,r=e.recipes,a=e.ratingsPerPage;return s.a.createElement(R,{aggregations:t.brands,searchPlaceholder:P.brandsSearchPlaceholder,recipes:r,ratingsPerPage:a})}}var W=r(179),L=r(173),D=r.n(L),A=r(117),B=r(56);class U extends s.a.PureComponent{constructor(...e){super(...e),this.onToggle=(e,t)=>{this.props.onToggle(t.label)}}render(){const e=this.props,t=e.items,r=e.className;return s.a.createElement("div",{className:r},s.a.createElement(B.a,{horizontal:!0},t.map(e=>s.a.createElement(B.a.Item,{key:e.label},s.a.createElement(A.a,{label:e.label,checked:e.checked,onChange:this.onToggle})))))}}class _ extends s.a.PureComponent{render(){const e=this.props.text;return s.a.createElement("div",null,(e=>{const t=[];return e.split("\n").forEach((e,r)=>{t.push(s.a.createElement("span",{key:"line-".concat(r)},e)),t.push(s.a.createElement("br",{key:"newline-".concat(r)}))}),t.pop(),t})(e))}}var j=r(175);class z extends s.a.PureComponent{constructor(...e){super(...e),this.onChange=(e,t)=>{this.props.onChange(t.value)}}render(){const e=this.props,t=e.items,r=e.checked,a=e.className;return s.a.createElement("div",{className:a},s.a.createElement(B.a,{horizontal:!0},t.map(e=>s.a.createElement(B.a.Item,{key:e.value},s.a.createElement(j.a,{label:e.label,value:e.value,checked:r===e.value,onChange:this.onChange})))))}}var F=r(183);class M extends s.a.PureComponent{render(){const e=this.props.rating;return s.a.createElement(F.a,{icon:"star",defaultRating:e,maxRating:5,disabled:!0})}}class J{constructor(e){const t=e.toString(),r=new Blob(["(".concat(t,")()")]);return new Worker(URL.createObjectURL(r))}}var V=()=>{const e=(e,t)=>{let r=!1;return t.forEach(t=>{-1!==e.indexOf(t)&&(r=!0)}),r},t=({recipes:t,numFilters:r,words:a})=>{const s=new Set;a.combined.forEach(e=>s.add(e)),a.brands.forEach(e=>s.add(e)),a.spirits.forEach(e=>s.add(e));const n=[];return t.map(e=>e.Ingredients).forEach(t=>{t.split("\n").filter(t=>!e(t,a.blacklist)).forEach(t=>{var r,i;(r=t,i=s,i.forEach(e=>{const t=new RegExp(e,"gi");r=r.replace(t,e.replace(/ /g,"_"))}),r).split(" ").map(e=>e.replace(/\([^)]*\)/g,"")).map(e=>(e=>e.replace(/_/g," "))(e)).map(e=>e.replace(/[^a-zA-Z ]/g,"")).filter(e=>e.length>0).map(e=>e.toLowerCase()).filter(t=>!e(t,a.quantity)).filter(t=>!e(t,a.ignored)).forEach(e=>n.push(e))})}),(e=>{const t=(e=>{const t={};return e.forEach(e=>{t[e]?t[e]++:t[e]=1}),t})(e);return{mostCommon:e=>Object.entries(t).sort((e,t)=>t[1]-e[1]).map(e=>e[0]).slice(0,e)}})(n).mostCommon(r).map(e=>({term:e,enabled:!1}))};self.addEventListener("message",e=>{if(!e||!e.data.numFilters)return;const r=t(e.data);postMessage(r)})};function G(){const e=localStorage.getItem("recipesCache.recipes");return e?JSON.parse(e):null}const $=(e,t)=>(t.forEach(t=>{const r=new RegExp(t,"gi");e=e.replace(r,t.replace(/ /g,"_"))}),e),H=e=>e.replace(/_/g," "),Z=[{label:P.recipesSortByDate,value:"date"},{label:P.recipesSortByRating,value:"rating",comparator:(e,t)=>t.Rating-e.Rating}],K=(e,t)=>({key:"recipe-".concat(t,"-").concat(e.Name,"-").concat(e.Ingredients),header:e.Name,description:s.a.createElement(c.b,{to:"/".concat(window.location.href.split("#")[1].split("/")[1],"/").concat(e.Name)},s.a.createElement(_,{text:H(e.Ingredients)})),meta:s.a.createElement(M,{rating:e.Rating})}),Q=e=>({label:e.term,checked:e.enabled});class X extends s.a.PureComponent{constructor(e){super(e),this.onSearchTermToggle=e=>{const t=this.state.filterTerms.map(({term:t,enabled:r})=>t===e?{term:t,enabled:!r}:{term:t,enabled:r});this.setState({filterTerms:t})},this.onSearchTextChange=e=>{const t=this.props.words,r=$(e,t.combined);this.setState({filterText:r})},this.onSortOrderChange=e=>{this.setState({sortOrder:e})},this.shouldShowRecipe=e=>{const t=this.state,r=t.filterTerms,a=t.filterText,s=this.props.words;return((e,t)=>{if(!t.length)return!0;const r=H(e.Ingredients).toLowerCase();return t.filter(e=>e.enabled).map(e=>e.term.toLowerCase()).every(e=>-1!==r.indexOf(e))})(e,r)&&((e,t,r)=>{if(!t)return!0;const a=$("".concat(e.Name,"\n").concat(e.Ingredients).toLowerCase(),r.combined),s=t.split("&&").map(e=>e.trim()).map(e=>e.toLowerCase()),n=D()(s,e=>e.startsWith("!")),i=Object(W.a)(n,2),o=i[0];return i[1].every(e=>-1!==a.indexOf(e))&&o.every(e=>-1===a.indexOf(e.substring(1)))})(e,a,s)},this.sort=e=>{const t=this.state.sortOrder,r=Z.filter(e=>e.value===t).map(e=>e.comparator)[0];return r&&(e=e.sort(r)),e},this.state={sortOrder:"date",filterText:e.query||"",filterTerms:[]}}componentDidMount(){const e=function(){const e=localStorage.getItem("recipesCache.filterTerms");return e?"1"===localStorage.getItem("recipesCache.filterTerms.dirty")?null:JSON.parse(e):null}();if(e)return void this.setState({filterTerms:e});const t=new J(V);t.postMessage(this.props),t.addEventListener("message",e=>{const t=e.data;!function(e){localStorage.setItem("recipesCache.filterTerms",JSON.stringify(e)),localStorage.setItem("recipesCache.filterTerms.dirty","0")}(t),this.setState({filterTerms:t})})}render(){const e=this.props,t=e.noSort,r=e.numFilters,a=e.recipes,n=e.recipesPerPage,i=this.state,o=i.filterTerms,c=i.filterText,l=i.sortOrder,p=this.sort(a.filter(this.shouldShowRecipe));return s.a.createElement("div",null,s.a.createElement("div",{className:"recipeControls"},r>0&&s.a.createElement(U,{className:"filters",items:o.map(Q),onToggle:this.onSearchTermToggle}),s.a.createElement(v,{className:"searchBar",defaultValue:c,placeholder:P.recipesSearchPlaceholder,onChange:this.onSearchTextChange}),!t&&s.a.createElement(z,{className:"sortOrder",items:Z,checked:l,onChange:this.onSortOrderChange})),s.a.createElement(f,{className:"paginatedCardGroup",itemsPerPage:n,items:p.map(K),key:p}))}}class Y extends s.a.PureComponent{render(){const e=this.props,t=e.words,r=e.recipes,a=e.ratingsPerPage;return s.a.createElement(R,{aggregations:t.spirits,searchPlaceholder:P.spiritsSearchPlaceholder,recipes:r,ratingsPerPage:a})}}function ee(e){if(e.status>=200&&e.status<300)return e;{const t=new Error(e.statusText);throw t.response=e,t}}function te(e){return e.json()}function re(e){return fetch(e).then(ee).then(te)}r(332),r(333);class ae extends s.a.Component{constructor(e){super(e),this.onRecipesLoaded=({recipes:e,aiRecipes:t,words:r},a)=>{this.setState({recipes:e,aiRecipes:t,words:{combined:new Set(r.combined||[]),blacklist:new Set(r.blacklist||[]),quantity:new Set(r.quantity||[]),brands:new Set(r.brands||[]),ignored:new Set(r.ignored||[]),spirits:new Set(r.spirits||[])},cacheDate:a})},this.onStaleDataWarningDismiss=()=>{this.setState({cacheDate:""})},this.renderIndex=e=>s.a.createElement(o.a,{to:"/recipes"}),this.renderRecipes=e=>s.a.createElement(X,{recipes:this.state.recipes,words:this.state.words,query:e.match.params.query,recipesPerPage:this.props.pageSize,numFilters:this.props.numFilters,key:e.match.params.query}),this.renderSpirits=e=>s.a.createElement(Y,{recipes:this.state.recipes,words:this.state.words,query:e.match.params.query,ratingsPerPage:this.props.pageSize}),this.renderBrands=e=>s.a.createElement(O,{recipes:this.state.recipes,words:this.state.words,query:e.match.params.query,ratingsPerPage:this.props.pageSize}),this.renderBottles=e=>s.a.createElement(I,{recipes:this.state.recipes,words:this.state.words,query:e.match.params.query,ratingsPerPage:this.props.pageSize}),this.renderAI=e=>s.a.createElement(X,{recipes:this.state.aiRecipes,words:this.state.words,query:e.match.params.query,recipesPerPage:this.props.pageSize,key:e.match.params.query,noSort:!0}),this.renderStaleDataWarning=e=>{const t=e.cacheDate;return t?s.a.createElement(m.a,{warning:!0,floating:!0,icon:!0,onDismiss:this.onStaleDataWarningDismiss,className:"messageTop"},s.a.createElement(p.a,{name:"plug"}),s.a.createElement(m.a.Content,null,s.a.createElement(m.a.Header,null,P.recipesLoadError),P.recipesCacheWarning," ",t)):null},this.renderNav=e=>{const t=e.location.pathname;return s.a.createElement(h.a,{icon:"labeled",size:"mini",fixed:"bottom"},s.a.createElement(h.a.Item,{as:c.b,to:"/recipes",active:t.startsWith("/recipes")},s.a.createElement(p.a,{name:"cocktail"}),P.menuEntryRecipes),s.a.createElement(h.a.Item,{as:c.b,to:"/spirits",active:t.startsWith("/spirits")},s.a.createElement(p.a,{name:"bar chart"}),P.menuEntrySpirits),s.a.createElement(h.a.Item,{as:c.b,to:"/brands",active:t.startsWith("/brands")},s.a.createElement(p.a,{name:"line chart"}),P.menuEntryBrands),s.a.createElement(h.a.Item,{as:c.b,to:"/bottles",active:t.startsWith("/bottles")},s.a.createElement(p.a,{name:"winner"}),P.menuEntryBottles),s.a.createElement(h.a.Item,{as:c.b,to:"/ai",active:t.startsWith("/ai")},s.a.createElement(p.a,{name:"flask"}),P.menuEntryAI))},this.state={error:null,recipes:[],aiRecipes:[],words:{},cacheDate:""}}componentDidMount(){const e=this.props,t=e.recipesUrl,r=e.aiRecipesUrl,a=e.wordsUrl;Promise.all([re(t),re(r),re(a)]).then(([e,t,r])=>{this.onRecipesLoaded({recipes:e,aiRecipes:t,words:r}),function(e){var t,r,a;const s=G();(null===s||void 0===s||null===(t=s.recipes)||void 0===t?void 0:t.length)===e.recipes.length&&(null===s||void 0===s||null===(r=s.aiRecipes)||void 0===r?void 0:r.length)===e.aiRecipes.length&&(null===s||void 0===s||null===(a=s.words)||void 0===a?void 0:a.length)===e.words.length||(localStorage.setItem("recipesCache.recipes",JSON.stringify({recipes:e.recipes,aiRecipes:e.aiRecipes,words:e.words,cacheDate:(new Date).toString()})),localStorage.setItem("recipesCache.filterTerms.dirty","1"))}({recipes:e,aiRecipes:t,words:r})}).catch(e=>{const t=G();if(!t)return void this.setState({error:e});const r=t.recipes,a=t.aiRecipes,s=t.words,n=t.cacheDate;this.onRecipesLoaded({recipes:r,aiRecipes:a,words:s},n)})}render(){const e=this.state,t=e.error,r=e.recipes,a=e.cacheDate;return t?s.a.createElement(l.a,null,s.a.createElement(m.a,{error:!0,content:P.recipesLoadError,className:"messageTop"})):0===r.length?null:s.a.createElement(c.a,null,s.a.createElement(l.a,null,this.renderStaleDataWarning({cacheDate:a}),s.a.createElement(o.b,{path:"*",component:this.renderNav}),s.a.createElement(o.d,null,s.a.createElement(o.b,{exact:!0,path:"/",component:this.renderIndex}),s.a.createElement(o.b,{exact:!0,path:"/recipes/:query?",render:this.renderRecipes}),s.a.createElement(o.b,{exact:!0,path:"/spirits/:query?",render:this.renderSpirits}),s.a.createElement(o.b,{exact:!0,path:"/brands/:query?",render:this.renderBrands}),s.a.createElement(o.b,{exact:!0,path:"/bottles/:query?",render:this.renderBottles}),s.a.createElement(o.b,{exact:!0,path:"/ai/:query?",render:this.renderAI}))))}}const se=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ne(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const r=e.installing;null!=r&&(r.onstatechange=()=>{"installed"===r.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}i.a.render(s.a.createElement(ae,{recipesUrl:"https://raw.githubusercontent.com/c-w/cocktails/master/recipes.json",aiRecipesUrl:"https://raw.githubusercontent.com/c-w/cocktails/master/lstm-recipes.json",wordsUrl:"https://raw.githubusercontent.com/c-w/cocktails/master/words.json",pageSize:parseInt("6",10),numFilters:parseInt("10",10)}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/cocktails",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="".concat("/cocktails","/service-worker.js");se?(!function(e,t){fetch(e).then(r=>{const a=r.headers.get("content-type");404===r.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):ne(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ne(t,e)})}}()}},[[192,1,2]]]);
//# sourceMappingURL=main.4155638c.chunk.js.map